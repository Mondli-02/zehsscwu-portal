<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Member Portal - ZEHSSCWU</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="assets/images/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="assets/images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="assets/images/favicon-16x16.png"
    />
    <link rel="manifest" href="assets/images/site.webmanifest" />
  </head>
  <body>
    <!-- Header -->
    <div class="header-container">
      <h1>ZEHSSCWU Member Portal</h1>
      <div class="header-actions">
        <span class="welcome-board" id="memberWelcome">Welcome, Member</span>
        <button class="btn btn-primary" onclick="logout()">Logout</button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="container" style="margin-top: 24px">
      <!-- Desktop Tabs Navigation (hidden on mobile) -->
      <div class="tabs">
        <div class="tab active" onclick="switchTab('profile', event)">
          Profile
        </div>
        <div class="tab" onclick="switchTab('worksCouncil', event)">
          Works Council & Committee
        </div>
        <div class="tab" onclick="switchTab('updateProfile', event)">
          Update Profile
        </div>
        <div class="tab" onclick="switchTab('unionTools', event)">
          Union Tools
        </div>
      </div>

      <!-- Profile Tab -->
      <div id="profile" class="tab-content active">
        <div class="card">
          <h2 style="margin-bottom: 20px; color: var(--primary)">
            Member Profile
          </h2>

          <div class="info-card">
            <div class="info-row">
              <span class="info-label">Member ID</span>
              <span class="info-value" id="profileMemberId">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">Full Name</span>
              <span class="info-value" id="profileFullName">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">Institution</span>
              <span class="info-value" id="profileInstitution">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">National ID</span>
              <span class="info-value" id="profileNationalId">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">Date of Birth</span>
              <span class="info-value" id="profileDob">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">Gender</span>
              <span class="info-value" id="profileGender">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">Job Title</span>
              <span class="info-value" id="profileJobTitle">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">Date Joined</span>
              <span class="info-value" id="profileDateJoined">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">Grade</span>
              <span class="info-value" id="profileGrade">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">Contact Number</span>
              <span class="info-value" id="profileContact">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">Status</span>
              <span class="info-value" id="profileStatus">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">Position in Union</span>
              <span class="info-value" id="profilePosition">-</span>
            </div>
            <div class="info-row">
              <span class="info-label">Branch</span>
              <span class="info-value" id="profileBranch">-</span>
            </div>
          </div>

          <button
            class="btn btn-primary"
            onclick="switchTab('updateProfile', event)"
          >
            Update Profile
          </button>
        </div>
      </div>

      <!-- Works Council & Committee Tab -->
      <div id="worksCouncil" class="tab-content">
        <div class="card">
          <h2 style="margin-bottom: 20px; color: var(--primary)">
            Works Council & Committee
          </h2>

          <!-- Works Council Section -->
          <div style="margin-bottom: 32px">
            <h3 style="margin-bottom: 16px; color: var(--secondary)">
              Works Council
            </h3>
            <div id="worksCouncilContent">
              <!-- Dynamic content will be loaded here -->
            </div>
          </div>

          <!-- Works Committee Section -->
          <div>
            <h3 style="margin-bottom: 16px; color: var(--secondary)">
              Works Committee
            </h3>
            <div id="worksCommitteeContent">
              <!-- Dynamic content will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Update Profile Tab -->
      <div id="updateProfile" class="tab-content">
        <div class="card">
          <h2 style="margin-bottom: 20px; color: var(--primary)">
            Update Profile
          </h2>

          <form id="updateProfileForm">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-input" id="updateFullName" />
              </div>

              <div class="form-group">
                <label class="form-label">National ID</label>
                <input type="text" class="form-input" id="updateNationalId" />
              </div>

              <div class="form-group">
                <label class="form-label">Date of Birth</label>
                <input type="date" class="form-input" id="updateDob" />
              </div>

              <div class="form-group">
                <label class="form-label">Gender</label>
                <select class="form-select" id="updateGender">
                  <option value="">Select Gender</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">Job Title</label>
                <input type="text" class="form-input" id="updateJobTitle" />
              </div>

              <div class="form-group">
                <label class="form-label">Date Joined</label>
                <input type="date" class="form-input" id="updateDateJoined" />
              </div>

              <div class="form-group">
                <label class="form-label">Grade</label>
                <input type="text" class="form-input" id="updateGrade" />
              </div>

              <div class="form-group">
                <label class="form-label">Contact Number</label>
                <input type="tel" class="form-input" id="updateContact" />
              </div>

              <div class="form-group">
                <label class="form-label">Position in Union</label>
                <input
                  type="text"
                  class="form-input"
                  id="updatePosition"
                  readonly
                  style="background: #f5f5f5"
                />
                <small
                  style="color: var(--error); display: block; margin-top: 4px"
                >
                  Contact admin to change this position
                </small>
              </div>

              <div class="form-group">
                <label class="form-label">Branch</label>
                <select class="form-select" id="updateBranch">
                  <option value="">Select Branch</option>
                  <option value="Matabeleland North">Matabeleland North</option>
                  <option value="Matabeleland South">Matabeleland South</option>
                  <option value="Bulawayo">Bulawayo</option>
                </select>
              </div>
            </div>

            <button
              type="submit"
              class="btn btn-primary"
              style="margin-top: 20px"
            >
              Update Profile
            </button>
          </form>
        </div>
      </div>

      <!-- Union Tools Tab -->
      <div id="unionTools" class="tab-content">
        <div class="card">
          <h2 style="margin-bottom: 20px; color: var(--primary)">
            Union Tools
          </h2>

          <div class="form-grid">
            <!-- Tool Card 1 -->
            <div class="info-card">
              <h3 style="margin-bottom: 12px">Dues Calculator</h3>
              <p style="margin-bottom: 16px; color: var(--secondary)">
                Calculate your monthly union dues based on your grade and salary
                scale.
              </p>
              <button
                class="btn btn-primary"
                onclick="visitTool('dues-calculator')"
              >
                Visit Tool
              </button>
            </div>

            <!-- Tool Card 2 -->
            <div class="info-card">
              <h3 style="margin-bottom: 12px">Grievance Reporting</h3>
              <p style="margin-bottom: 16px; color: var(--secondary)">
                Submit and track workplace grievances through our secure portal.
              </p>
              <button
                class="btn btn-primary"
                onclick="visitTool('grievance-reporting')"
              >
                Visit Tool
              </button>
            </div>

            <!-- Tool Card 3 -->
            <div class="info-card">
              <h3 style="margin-bottom: 12px">Training Portal</h3>
              <p style="margin-bottom: 16px; color: var(--secondary)">
                Access union training materials and register for upcoming
                workshops.
              </p>
              <button
                class="btn btn-primary"
                onclick="visitTool('training-portal')"
              >
                Visit Tool
              </button>
            </div>

            <!-- Tool Card 4 -->
            <div class="info-card">
              <h3 style="margin-bottom: 12px">Meeting Scheduler</h3>
              <p style="margin-bottom: 16px; color: var(--secondary)">
                Schedule and manage union meetings with your institution
                representatives.
              </p>
              <button
                class="btn btn-primary"
                onclick="visitTool('meeting-scheduler')"
              >
                Visit Tool
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Bottom Navigation (visible only on mobile) -->
    <nav class="bottom-nav">
      <div
        class="nav-item active"
        onclick="switchTab('profile', event)"
        data-tab="profile"
      >
        <svg class="nav-icon" viewBox="0 0 24 24">
          <path
            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
          />
        </svg>
        <span class="nav-label">Profile</span>
      </div>

      <div
        class="nav-item"
        onclick="switchTab('worksCouncil', event)"
        data-tab="worksCouncil"
      >
        <svg class="nav-icon" viewBox="0 0 24 24">
          <path
            d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"
          />
        </svg>
        <span class="nav-label">Council</span>
      </div>

      <div
        class="nav-item"
        onclick="switchTab('updateProfile', event)"
        data-tab="updateProfile"
      >
        <svg class="nav-icon" viewBox="0 0 24 24">
          <path
            d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"
          />
        </svg>
        <span class="nav-label">Update</span>
      </div>

      <div
        class="nav-item"
        onclick="switchTab('unionTools', event)"
        data-tab="unionTools"
      >
        <svg class="nav-icon" viewBox="0 0 24 24">
          <path
            d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"
          />
        </svg>
        <span class="nav-label">Tools</span>
      </div>
    </nav>

    <!-- Support Button -->
    <div class="support-btn" onclick="contactSupport()">
      <span>Contact Support</span>
      <img
        src="assets/images/whatsapp-icon.svg"
        alt="WhatsApp"
        width="20"
        height="20"
        onerror="this.style.display='none'"
      />
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/member.js"></script>
    <script>
      // Initialize Supabase
      const supabaseUrl = "https://wugbnnyyovblandiqqqp.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind1Z2Jubnl5b3ZibGFuZGlxcXFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NTA1NzQsImV4cCI6MjA3NTMyNjU3NH0.qSBW1y8vxKTKIKvFsk9O2mNCBaPyPJj6dSLzYmSJ_wE";
      window.supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

      // Enhanced switchTab function to update both desktop tabs and mobile bottom nav
      function switchTab(tabName, event) {
        // Prevent default if event exists
        if (event) {
          event.preventDefault();
        }

        // Hide all tab contents
        const tabContents = document.querySelectorAll(".tab-content");
        tabContents.forEach((content) => {
          content.classList.remove("active");
        });

        // Remove active class from all desktop tabs
        const desktopTabs = document.querySelectorAll(".tabs .tab");
        desktopTabs.forEach((tab) => {
          tab.classList.remove("active");
        });

        // Remove active class from all mobile bottom nav items
        const bottomNavItems = document.querySelectorAll(
          ".bottom-nav-item, .nav-item"
        );
        bottomNavItems.forEach((item) => {
          item.classList.remove("active");
        });

        // Show the selected tab content
        const selectedTabContent = document.getElementById(tabName);
        if (selectedTabContent) {
          selectedTabContent.classList.add("active");
        }

        // Add active class to the corresponding desktop tab
        const desktopTabElement = event?.currentTarget
          ?.closest(".tabs")
          ?.querySelector(`.tab[onclick*="${tabName}"]`);
        if (desktopTabElement) {
          desktopTabElement.classList.add("active");
        }

        // Add active class to the corresponding mobile bottom nav item
        const bottomNavItem = document.querySelector(
          `.bottom-nav-item[data-tab="${tabName}"], .nav-item[data-tab="${tabName}"]`
        );
        if (bottomNavItem) {
          bottomNavItem.classList.add("active");
        }

        // Scroll to top smoothly
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      // Initialize member dashboard when page loads
      document.addEventListener("DOMContentLoaded", function () {
        initializeMemberDashboard();
      });
    </script>
  </body>
</html>
